<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LAN Quiz Game</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #0d0d2b; --primary-color: #e94560; --secondary-color: #16213e;
            --glow-color: #ff007f; --text-color: #e0e0e0; --text-dark: #a0a0c0;
            --correct-color: #28a745; --incorrect-color: #dc3545; --font-family: 'Rajdhani', sans-serif;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: var(--font-family); background: var(--bg-color); color: var(--text-color);
            display: flex; justify-content: center; align-items: center; min-height: 100vh;
            overflow: hidden;
            /* Background SVG with subtle gradient overlays */
            background-image:
                linear-gradient(rgba(9,12,24,0.25), rgba(9,12,24,0.25)),
                url('assets/login-bg.svg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            /* keep subtle additional radial highlights for contrast */
            box-shadow: inset 0 0 120px rgba(0,0,0,0.35);
        }
        .container { width: 100%; max-width: 900px; padding: 20px; }
        .screen { display: none; flex-direction: column; align-items: center; text-align: center; animation: fadeIn 0.5s ease-in-out; }
        .screen.active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        
        .login-card { background: var(--secondary-color); padding: 40px; border-radius: 15px; border: 1px solid rgba(233, 69, 96, 0.3); box-shadow: 0 0 30px rgba(0,0,0,0.5); }
        h1 { font-size: 3rem; font-weight: 700; text-shadow: 0 0 10px var(--glow-color); margin-bottom: 20px; }
        input[type="text"] {
            width: 100%; padding: 15px; background: var(--bg-color); border: 1px solid var(--primary-color);
            border-radius: 8px; color: var(--text-color); font-family: var(--font-family); font-size: 1.2rem;
            text-align: center; transition: all 0.3s ease; margin: 20px 0;
        }
        input[type="text"]:focus { outline: none; box-shadow: 0 0 15px var(--glow-color); border-color: var(--glow-color); }
        .glow-button {
            background: var(--primary-color); color: white; border: none; padding: 15px 40px;
            font-family: var(--font-family); font-size: 1.3rem; font-weight: 700; border-radius: 8px;
            cursor: pointer; transition: all 0.3s ease; box-shadow: 0 0 10px var(--primary-color), 0 0 20px var(--glow-color);
        }
        .glow-button:hover { transform: translateY(-3px); box-shadow: 0 0 15px var(--primary-color), 0 0 30px var(--glow-color), 0 0 45px var(--glow-color); }

        .status-header { width: 100%; display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; padding: 15px; background: rgba(22, 33, 62, 0.5); border-radius: 10px; }
        .player-name { font-size: 1.5rem; font-weight: 700; }
        .player-count { font-size: 1.2rem; color: var(--text-dark); }
        .question-card, .waiting-card { background: var(--secondary-color); padding: 30px; border-radius: 15px; border: 1px solid rgba(233, 69, 96, 0.3); width: 100%; min-height: 450px; }
        h2, h3 { margin-bottom: 20px; }
        #waiting-message { font-size: 1.5rem; color: var(--text-dark); }
        .question-text { font-size: 1.8rem; font-weight: 500; margin-bottom: 30px; min-height: 80px; }
        #player-list { list-style: none; font-size: 1.2rem; }
        #player-list li { padding: 5px; }
        .options-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; width: 100%; margin-bottom: 25px;}
        .option-button {
            width: 100%; padding: 20px; font-size: 1.2rem; font-family: var(--font-family); background: var(--bg-color);
            color: var(--text-color); border: 2px solid var(--primary-color); border-radius: 10px; cursor: pointer; transition: all 0.2s ease;
        }
        .option-button.selected { background: var(--primary-color); color: white; border-color: var(--glow-color); transform: scale(1.03); }
        
        /* New Navigation Styles */
        .navigation-controls { display: flex; justify-content: space-between; align-items: center; width: 100%; padding: 10px 0;}
        .nav-button { background: none; border: 2px solid var(--primary-color); color: var(--primary-color); padding: 10px 25px; border-radius: 8px; font-size: 1.1rem; font-family: var(--font-family); font-weight: 700; cursor: pointer; transition: all 0.3s ease;}
        .nav-button:hover:not(:disabled) { background: var(--primary-color); color: white; }
        .nav-button:disabled { border-color: var(--text-dark); color: var(--text-dark); cursor: not-allowed; opacity: 0.5; }
        #question-counter { font-size: 1.4rem; font-weight: 500; color: var(--text-dark); }

        #results-title { font-size: 2.5rem; }
        #final-score { font-size: 4rem; font-weight: 700; color: var(--primary-color); margin: 20px 0; text-shadow: 0 0 20px var(--glow-color); }
        #results-message { font-size: 1.3rem; color: var(--text-dark); }
    </style>
</head>
<body>
    <div class="container">
        <div class="screen active" id="login-screen">
            <div class="login-card">
                <h1>LAN QUIZ</h1>
                <input type="text" id="name-input" placeholder="ENTER YOUR NAME" maxlength="20">
                <button class="glow-button" id="join-button">JOIN GAME</button>
            </div>
        </div>

        <div class="screen" id="waiting-screen">
            <div class="status-header">
                <div class="player-name" id="waiting-player-name"></div>
                <div class="player-count" id="waiting-player-count"></div>
            </div>
            <div class="waiting-card">
                <h2 id="waiting-message">Waiting for the quiz to start...</h2>
                <h3>Connected Players:</h3>
                <ul id="player-list"></ul>
            </div>
        </div>

        <div class="screen" id="question-screen">
            <div class="status-header">
                <div class="player-name" id="game-player-name"></div>
                <div id="question-counter"></div>
            </div>
            <div class="question-card">
                <p class="question-text" id="question-text"></p>
                <div class="options-grid" id="options-grid"></div>
                <div class="navigation-controls">
                    <button class="nav-button" id="prev-button">Previous</button>
                    <button class="nav-button" id="next-button">Next</button>
                </div>
            </div>
        </div>

        <div class="screen" id="results-screen">
            <h2 id="results-title">Quiz Over!</h2>
            <p id="final-score"></p>
            <p id="results-message">Thanks for playing! Waiting for the next round.</p>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Element Refs
            const screens = { login: document.getElementById('login-screen'), waiting: document.getElementById('waiting-screen'), question: document.getElementById('question-screen'), results: document.getElementById('results-screen') };
            const nameInput = document.getElementById('name-input');
            const joinButton = document.getElementById('join-button');
            const waitingPlayerName = document.getElementById('waiting-player-name');
            const gamePlayerName = document.getElementById('game-player-name');
            const waitingPlayerCount = document.getElementById('waiting-player-count');
            const playerList = document.getElementById('player-list');
            const questionText = document.getElementById('question-text');
            const optionsGrid = document.getElementById('options-grid');
            const questionCounter = document.getElementById('question-counter');
            const prevButton = document.getElementById('prev-button');
            const nextButton = document.getElementById('next-button');
            const finalScore = document.getElementById('final-score');
            const resultsTitle = document.getElementById('results-title');

            // Game State
            let ws;
            let playerName = '';
            let questions = [];
            let userAnswers = [];
            let currentQuestionIndex = 0;

            const showScreen = (screenName) => {
                Object.values(screens).forEach(s => s.classList.remove('active'));
                screens[screenName].classList.add('active');
            };

            const connectToServer = () => {
                playerName = nameInput.value.trim();
                if (!playerName) { alert('Please enter a name!'); return; }
                const wsHost = `ws://${window.location.hostname}:8765`;
                ws = new WebSocket(wsHost);

                ws.onopen = () => {
                    ws.send(JSON.stringify({ type: 'login', name: playerName }));
                    waitingPlayerName.textContent = playerName;
                    gamePlayerName.textContent = playerName;
                    showScreen('waiting');
                };
                ws.onmessage = (event) => handleServerMessage(JSON.parse(event.data));
                ws.onclose = () => { alert('Connection lost. Please refresh to reconnect.'); showScreen('login'); };
                ws.onerror = () => alert('Could not connect to the game server.');
            };
            
            joinButton.addEventListener('click', connectToServer);
            nameInput.addEventListener('keyup', (e) => { if (e.key === 'Enter') connectToServer(); });

            const handleServerMessage = (data) => {
                switch (data.type) {
                    case 'player_update': updatePlayerList(data.players); break;
                    case 'start_quiz': startQuiz(data.questions); break;
                    case 'quiz_end': showResults(data); break;
                }
            };
            
            const updatePlayerList = (players) => {
                waitingPlayerCount.textContent = `${players.length} Player(s) Online`;
                playerList.innerHTML = players.map(name => `<li>${name}</li>`).join('');
            };

            const startQuiz = (quizQuestions) => {
                questions = quizQuestions;
                userAnswers = new Array(questions.length).fill(null);
                currentQuestionIndex = 0;
                renderQuestion();
                showScreen('question');
            };

            const renderQuestion = () => {
                if (questions.length === 0) return;

                const question = questions[currentQuestionIndex];
                questionText.textContent = question.question;
                optionsGrid.innerHTML = '';

                question.options.forEach((optText, idx) => {
                    const optionNumber = String(idx + 1);
                    const btn = document.createElement('button');
                    btn.className = 'option-button';
                    btn.dataset.option = optionNumber;
                    btn.textContent = optText;

                    if (userAnswers[currentQuestionIndex] === optionNumber) {
                        btn.classList.add('selected');
                    }

                    btn.addEventListener('click', () => selectAnswer(optionNumber, btn));
                    optionsGrid.appendChild(btn);
                });

                updateNavigation();
            };

            const selectAnswer = (optionNumber, selectedButton) => {
                userAnswers[currentQuestionIndex] = optionNumber;
                // Visually update which button is selected
                optionsGrid.querySelectorAll('.option-button').forEach(b => b.classList.remove('selected'));
                selectedButton.classList.add('selected');
            };

            const updateNavigation = () => {
                questionCounter.textContent = `Question ${currentQuestionIndex + 1} of ${questions.length}`;
                prevButton.disabled = (currentQuestionIndex === 0);
                
                if (currentQuestionIndex === questions.length - 1) {
                    nextButton.textContent = 'Submit';
                } else {
                    nextButton.textContent = 'Next';
                }
            };
            
            prevButton.addEventListener('click', () => {
                if (currentQuestionIndex > 0) {
                    currentQuestionIndex--;
                    renderQuestion();
                }
            });

            nextButton.addEventListener('click', () => {
                // If it's the last question, submit the quiz
                if (currentQuestionIndex === questions.length - 1) {
                    ws.send(JSON.stringify({ type: 'submit_quiz', answers: userAnswers }));
                } else {
                    currentQuestionIndex++;
                    renderQuestion();
                }
            });

            const showResults = (data) => {
                const { score, total_questions } = data;
                finalScore.textContent = `${score} / ${total_questions}`;
                resultsTitle.textContent = (score === total_questions && total_questions > 0) ? "PERFECT SCORE!" : "Quiz Results";
                showScreen('results');
                // After showing results, go back to the waiting screen for the next game
                setTimeout(() => showScreen('waiting'), 8000);
            };
        });
    </script>
</body>
</html>